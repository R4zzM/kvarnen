<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Schemaläggaren</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Schemaläggaren">
  <meta name="author" content="Rasmus Mattsson">
  <link href="css/bootstrap.css" rel="stylesheet">

  <!-- Placeholder to override css from bootstrap -->
  <style type="text/css">

  </style>

  <link rel="shortcut icon" href="ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
</head>
<body>

  <div class="container">

    <!-- Header -->
    <div class="page-header">
      <h1>Schemaläggaren</h1>
    </div>

    <div class="row">
      <div class="span4">
        <div class="well">
          <ul class="nav nav-list">
           <li id="employees" class="nav-header"><big>1. Personal [<a href="#" id="addEmployee" onClick="ViewManager.getInstance().showEmployeeAddForm()">+</a>]</big></li>
           <li id="roles" class="nav-header"><big>2. Roller [<a href="#" id="addRole" onClick="ViewManager.getInstance().showRoleAddForm()">+</a>]</big></li>
           <li id="daily" class="nav-header"><big>4. Dagar [<a href="#" id="addDayTemplate" onClick="ViewManager.getInstance().showDayTemplateAddForm()">+</a>]</big></li>
           <li id="weekly" class="nav-header"><big>5. Veckor [<a href="#" id="ViewManager.getInstance().addWeekTemplate()">+</a>]</big></li>
           <li id="weekly" class="nav-header"><big>6. Säsonger [<a href="#" id="ViewManager.getInstance().addSeasonTemplate()">+</a>]</big></li>
         </ul>
       </div>
     </div>

     <div class="span7">

      <!-- Form to add/update/remove employees -->
      <form id ="addEmployeeForm" class="form-horizontal">

        <input type="hidden" id="employeeUid">

        <div class="control-group">
          <label class="control-label" for="employeeNameInput">Namn</label>
          <div class="controls">
            <input type="text" id="employeeNameInput">
          </div>
        </div>

        <div class="control-group">
          <label class="control-label" for="minHoursPerDay">Min tid per dag</label>
          <div class="controls">
            <select id="minHoursPerDay">
              <option>0</option>
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
              <option>6</option>
              <option>7</option>
              <option>8</option>
            </select>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label" for="maxHoursPerDay">Max tid per dag</label>
          <div class="controls">
            <select id="maxHoursPerDay">
              <option>0</option>
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
              <option>6</option>
              <option>7</option>
              <option>8</option>
              <option>9</option>
              <option>10</option>
              <option>11</option>
              <option>12</option>
              <option>13</option>
              <option>14</option>
              <option>15</option>
              <option>16</option>
            </select>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label" for="minHoursPerWeek">Min tid per vecka</label>
          <div class="controls">
            <select id="minHoursPerWeek">
              <option>0</option>
              <option>5</option>
              <option>10</option>
              <option>15</option>
              <option>20</option>
              <option>25</option>
              <option>30</option>
              <option>35</option>
              <option>40</option>
            </select>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label" for="maxHoursPerWeek">Max tid per vecka</label>
          <div class="controls">
            <select id="maxHoursPerWeek">
              <option>0</option>
              <option>5</option>
              <option>10</option>
              <option>15</option>
              <option>20</option>
              <option>25</option>
              <option>30</option>
              <option>35</option>
              <option>40</option>
              <option>45</option>
              <option>50</option>
              <option>55</option>
              <option>60</option>
              <option>65</option>
              <option>70</option>
              <option>75</option>
              <option>80</option>
            </select>
          </div>
        </div>

        <div id="addEmployeeButton" class="control-group">
          <div class="controls">
            <button class="btn btn-success" id="addEmployeeButtonButton" onClick="AppController.getInstance().addEmployee()">Skapa</button>
          </div>
        </div>

        <div id="updateEmployeeButton" class="control-group">
          <div class="controls">
            <button class="btn btn-primary" onClick="AppController.getInstance().updateEmployee()">Uppdatera</button>
            <button class="btn btn-danger" onClick="AppController.getInstance().removeEmployee()">Radera</button>
          </div>
        </div>
      </form>

      <!-- Form to add/update/remove roles -->
      <form id="addRoleForm" class="form-horizontal">

        <input type="hidden" id="roleUid">

        <div class="control-group">
          <label class="control-label" for="roleFormNameInput">Namn</label>
          <div class="controls">
            <input type="text" id="roleFormNameInput">
          </div>
        </div>

        <div class="control-group">
          <div class="controls" id="employeesWithRole">
            <!-- Employees associated with role are shown here. Added dynamically-->
          </div>
        </div>

        <div id="addRoleButton" class="control-group">
          <div class="controls">
            <button type="submit" class="btn btn-success" onClick="AppController.getInstance().addRole()">Skapa</button>
          </div>
        </div>

        <div id="updateRoleButton" class="control-group">
          <div class="controls">
            <button type="submit" class="btn btn-primary" onClick="AppController.getInstance().updateRole()">Uppdatera</button>
            <button type="submit" class="btn btn-danger" onClick="AppController.getInstance().removeRole()">Radera</button>
          </div>
        </div>
      </form>

      <!-- Form to add/update/remove templates -->
      <form id="templateForm" class="form-horizontal">

        <input type="hidden" id="dayTemplateUid">

        <div class="control-group">
          <label class="control-label" for="templateNameInput">Namn</label>
          <div class="controls">
            <input type="text" id="templateNameInput">
          </div>
        </div>

        <div class="control-group">
          <div id="positionsTable">
            <table id="positionTable" class="table table-striped">
              <thead>
                <tr>
                  <th>Roll</th>
                  <th>Start (timma)</th>
                  <th>Slut (timma)</th>
                  <tr>
                  </thead>
                  <tbody id="positionTableBody">
                    <!-- rendered dynamically -->
                  </tbody>
                </table>
              </div>
            </div>

            <div id="addDayTemplateButton" class="control-group">
              <div class="controls">
                <button type="submit" class="btn btn-success" onClick="AppController.getInstance().addDayTemplate()">Skapa</button>
              </div>
            </div>

            <div id="updateTemplateButton" class="control-group">
              <div class="controls">
                <button type="submit" class="btn btn-primary" onClick="AppController.getInstance().updateDayTemplate()">Uppdatera</button>
                <button type="submit" class="btn btn-danger" onClick="AppController.getInstance().removeDayTemplate()">Radera</button>
              </div>
            </div>
          </form>

          <div class="alert alert-success" id="alertSuccess">
            <button type="button" class="close" data-dismiss="alert">×</button>
          </div>
          <div class="alert alert-error" id="alertError">
            <button type="button" class="close" data-dismiss="alert">×</button>
          </div>

        </div>
      </div>
    </div>

    <!-- Sourced scripts -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="AppController.js"></script>
    <script src="DataStorage.js"></script>
    <script src="ViewManager.js"></script>

    <!-- Inline script that controls the UI -->
    <script type="text/javascript">

    // creates an element for the left side selection list
    function createListElement(name, uid, onClickFunction) {
      var listElement = $("<li></li>");
      var anchorElement = $("<a href=\"#\"></a>");
      $(listElement).attr('id', uid);
      $(anchorElement).attr('onClick', onClickFunction);
      $(anchorElement).html(name);
      $(listElement).append(anchorElement);
      return listElement;
    }

    function createCheckboxElement(name, uid, checked) {
     var checkboxLabel = $("<label class=\"checkbox\"></label>"); 
     var checkbox = $("<input class=\"employeeWithRole\" type=\"checkbox\">");
     checkbox.attr('id', new Number(uid).toString());
     if (checked == 'on') {
      $(checkbox).attr('checked', 'on');
    }
    $(checkboxLabel).append(name);
    $(checkboxLabel).append(checkbox);
    return checkboxLabel;
  }

  function createPosTableRow(roleName, roleUid, startHour, endHour) {

    var row = $("<tr></tr>");
    $(row).attr('class', 'positionTableDynamicRow');

    var roleCol = $("<td></td");
    $(roleCol).attr('class', 'positionTableRoleCol');
    $(roleCol).attr('id', roleUid);

    $(roleCol).html(roleName);

    var startHourCol = $("<td></td");
    $(startHourCol).attr('class', 'positionTableStartHourCol');
    $(startHourCol).html(startHour);

    var endHourCol = $("<td></td");
    $(endHourCol).attr('class', 'positionTableEndHourCol');
    $(endHourCol).html(endHour);

    var removeButtonCol = $("<td><a class=\"btn btn-small\" href=\"#\"><i class=\"icon-minus-sign\"></i></a></td>");
    $(removeButtonCol).attr('onclick', "removePosTableRow(this.parentNode)");

    $(row).append(roleCol);
    $(row).append(startHourCol);
    $(row).append(endHourCol);
    $(row).append(removeButtonCol);

    return row;
  }

  function createPosTableAddRow() {

    var permanentAddRow = $("<tr></tr>");
    permanentAddRow.attr('id', 'permanentPositionAddRow');

    var roleSelectorCol = $("<td></td>");
    var roleSelector = $("<select id=\"positionRoleSelect\"></select>");

    var roles = DataStorage.getInstance().getRoles();
    for (var idx in roles) {
      var optionNode = createOptionNode(roles[idx].name, roles[idx].uid);
      $(roleSelector).append(optionNode);        
    }

    roleSelectorCol.append(roleSelector);

    var startTimeSelectorCol = $("<td></td>");
    var startTimeSelector = $("<select id=\"positionStartTimeSelect\"></select>");
    var endTimeSelectorCol = $("<td></td>");
    var endTimeSelector = $("<select id=\"positionEndTimeSelect\"></select>");
    var hour;
    for (var i = 0; i < 24; i++) {
      if (i < 9) {
        hour = "0" + i;
      } else {
        hour = i;
      }
      startTimeSelector.append($("<option>" + i + "</option>"));
      endTimeSelector.append($("<option>" + i + "</option>"));
    }

    var addButtonCol = $("<td></td>");
    var button = $("<a class=\"btn btn-small\" href=\"#\" onClick=\"insertPosTableRow()\"><i class=\"icon-plus-sign\"></i></a>\"");
    addButtonCol.append(button);
    

    startTimeSelectorCol.append(startTimeSelector);
    endTimeSelectorCol.append(endTimeSelector);

    permanentAddRow.append(roleSelectorCol);
    permanentAddRow.append(startTimeSelectorCol);
    permanentAddRow.append(endTimeSelectorCol);
    permanentAddRow.append(addButtonCol);

    return permanentAddRow;
  }

  function createOptionNode(optionText, id) {
    var optionNode = $("<option></option>");
    $(optionNode).attr('class', 'requiredRoleOption');
    $(optionNode).html(optionText);
    if (id) {
      $(optionNode).attr('id', id);
    }
    return optionNode;
  }

  $(document).ready(function () {

    ViewManager.getInstance().hideAllForms();
    ViewManager.getInstance().hideAllAlerts();

    AppController.getInstance().init();

      // disable enter key for all forms
      $("form#addRoleForm").bind("keypress", function (e) {
        if (e.keyCode == 13 ) {
          return false;
        }
      });

      $("form#addEmployeeForm").bind("keypress", function (e) {
        if (e.keyCode == 13 ) {
          return false;
        }
      });

    });

</script>
</body>
</html>